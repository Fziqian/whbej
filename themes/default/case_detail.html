<{include file="block/sheader.html"}>
    <{include file="block/header.html"}>
    <div class="crumbs">
        <ul class="margin">
            <li>您当前的位置:</li>
            <li><a href="<{link ctl='index'}>" >首页</a></li>
            <li>><a href="<{link ctl='case'}>" target="_blank">案例展示 </a></li>
            <li>><{$detail.title}></li>
        </ul>
    </div>
    <div class="clear"></div>
    <div class="case-detail-content margin">
    	<div class="case-detail-top">
    		<h2><{$detail.title}></h2>
    		<!--<ul>
    			<li>设计师：<{$designer_list[$detail.designer_id].name}><i></i></li>
    			<li><{$detail.likes}>人喜欢<i></i></li>
    		</ul>-->
    	</div>
    	<div class="case-detail-bottom">       
            <div class="focusimg">
            </div> 
            <div class="focustool">
                <div class="ftoollist margin">
                    <ul>
                        <{foreach $photos as $p}>                
                            <li>
                            <img  src="<{$pager.img}>/<{$p.photo}>_small.jpg" data-big="<{$pager.img}>/<{$p.photo}>" >
                            </li>
                        <{/foreach}>
                    </ul>
                </div>
                
                <p class="btn_pre"></p>
                <p class="btn_next"></p>
            </div>
    	</div>
    	<div class="case-detail-explain">
    		<p>设计说明</p>
    		<{$detail.intro}>
    	</div>
    	<div class="case-detail-comment">
    		<div class="case-detail-comment-form">
                <form>
                    <input type="hidden" value="<{link ctl='case:comment' http='empty' arg0=$detail.case_id}>">
        			<ul>
        				<li>
        					<p>用户评论</p>
        					<p><input type="text" name="data[nickname]"></p>
        					<p>昵称<b>(建议16字以内)</b></p>
        				</li>
        				<li><textarea name="data[content]" class="text" placeholder=" 随便说点什么..."></textarea></li>
        				<li><bottom class="anlisubmit">评论</bottom></li>
                        <!-- <li><input type="submit" value="提交"></li> -->
        			</ul>
                </form>
    		</div>
    		<div class="case-detail-comment-wenzi">
    			<ul>
    				<li>
    					<h2><b><{$pager.count}></b>评论</h2>
                        <{foreach $items as $c}>
                        <p><b><{$c.nickname}></b> <{$c.dateline|format:'Y-m-d'}></p>
                        <p><{$c.content}></p>
                        <{/foreach}>
    				</li>
    			</ul>
    		</div>
    	</div>
    </div>
    <script>
        /* 效果图图片切换 */
        var gheight = 600;                         //固定高度
        var img = document.createElement('img');   //添加img标签
        var gfater = $('.ftoollist ul');           //缩略国父级
        var ximg = $("<img src='/themes/default/images/loading.gif' />").css({
            width : '24px',
            height : '24px',
            display : "block",
            margin : "288px auto",
        });
        $('.focusimg').append(ximg);   //图片为加载完时显示gif动图
        var qimg = $('.ftoollist ul li').eq(0).find('img').data('big');
        loadimg( img, qimg, gheight );
        //设置父级宽度
        gfater.css({
            'width' : gfater.find("li").length*gfater.find("li").eq(0).width(),
            'height' : "65px"
                });
        //左移动
        $(document).on('click','.focustool .btn_pre',function(){
            if( $(this).parent().find('ul').width() > $(this).parent().width()+116 ){
                lrmover( gfater, "-=", 800 );
                // gfater.animate({
                //  'left' : "-=116px"
                // }, 800);
            }
        })
        //右移动
        $(document).on('click','.focustool .btn_next',function(){
            if( $(this).parent().find('ul').position().left < -116 ){
                lrmover( gfater, "+=", 800 );
                // gfater.animate({
                //  'left' : "+=116px"
                // }, 800);
            }
        })
        function lrmover( gfater, calculation, speed ){
            gfater.animate({
                'left' : calculation+"116px"
            }, speed);
        }
        $(document).on('mouseover','.ftoollist li',function(){
            $(this).siblings().removeClass("on");
            $(this).addClass("on");
            var bigsrc = $(this).find('img').data('big');
            loadimg( img, bigsrc, gheight )
        });
        function loadimg( img, bigsrc, gheight ){
            var yw;         //原图宽
            var yh;         //原图高
            $('.focusimg').find("img").remove();  //清除初始加载的gif
            img.src = bigsrc;
            img.addEventListener('load',function(){
                yw = this.width+'px';
                yh = this.height+'px';
                if( parseInt(yh) > gheight ){ 
                    var xw = Math.ceil ( (gheight*parseInt(yw))/parseInt(yh));
                    $('.focusimg').append(this).find("img").css({
                        width : xw,
                        height : gheight+"px",
                        display : "block",
                        margin : "0 auto",
                        opacity: 0
                    }).animate({
                        opacity: 1,
                    }, 1000); 
                }else{
                    $('.focusimg').append(this).find("img").css({
                        width : yw,
                        height : yh,
                        display : "block",
                        margin : "0 auto",
                        opacity: 0
                    }).animate({
                        opacity: 1,
                    }, 1000); 
                }
            })
        }
    </script>
<{include file="block/footer.html"}>
